library(betaMix)
dat <- read.csv("~/Desktop/Scaled_20230403.csv")
disease <- which(dat$Disease.associated == 1)
nodisease <- which(dat$Disease.associated == 0)
sdis <- sort(sample(disease, 80))
sndis <- sort(sample(nodisease, 80))
M <- as.matrix(dat[c(sdis, sndis), -1], ncol=ncol(dat)-1, nrow=160)
bmfit <- betaMix(M, ind=TRUE)
plotFittedBetaMix(bmfit)
shortSummary(bmfit)
adjM <- Matrix(getAdjMat(bmfit, signed = TRUE))
image(adjM)
gc1 <- graphComponents(adjM, minCtr = 3, type = 1)
summarizeClusters(gc1)
plotCluster(adjM, 2, labels = TRUE, edgecols = c("blue","orange"))
gc1
Adj1 <- collapsedGraph(adjM, gc1) != 0
hist(dat$Hex.splicing..mut.[disease], breaks=30, freq=F)
hist(dat$Hex.splicing..mut.[nodisease], breaks=30, add=T, col=rgb(1,0,0,0.5), freq=F)
table(dat$Near.Splice.Junction....7.nt....1.Yes...0.No., dat$Disease.associated)
table(dat$Turn, dat$Disease.associated)
spineplot(table(dat$Turn, dat$Disease.associated))
table(dat$Near.Splice.Junction....7.nt....1.Yes...0.No., dat$Disease.associated)
spineplot(table(dat$Near.Splice.Junction....7.nt....1.Yes...0.No., dat$Disease.associated))
table(dat$Turn)
spineplot(table(dat$Turn, dat$Disease.associated))
plot(graph.adjacency(Adj1, mode="undirected"), vertex.label=rownames(Adj1),
vertex.label.cex=0.7, vertex.size=0, vertex.frame.color="white",
vertex.label.color='blue', edge.color='grey80',  asp=1)
plotCluster(adjM, 1, labels = TRUE, edgecols = c("blue","orange"))
plot(graph.adjacency(Adj1, mode="undirected"), vertex.label=rownames(Adj1),
vertex.label.cex=0.7, vertex.size=0, vertex.frame.color="white",
vertex.label.color='blue', edge.color='grey80',  asp=1)
plotCluster(adjM, 1, labels = TRUE, edgecols = c("blue","orange"))
greendots <- which(adjM[94,] != 0)
cols <- c(rep('lightblue', 93), 'red')
cols[greendots] <- 'darkgreen'
plot(graph.adjacency(adjM!=0, mode="undirected"), vertex.label=rownames(adjM),
vertex.label.cex=0.7, vertex.size=0, vertex.frame.color="white",
vertex.label.color=cols, edge.color='grey80',  asp=1)
preds <- greendots
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
dat2 <- dat[,c(95, 1+preds)]
dat2$Disease.associated <- as.factor(dat2$Disease.associated)
library(e1071)
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
library(randomForest)
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
importance(fitrf, type=1)
sum(diag(table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
greendots
preds <- which(colnames(dat) %in5% c("Hex.splicing..mut.","Near.Splice.Junction....7.nt....1.Yes...0.No.","Turn"))
preds <- which(colnames(dat) %in% c("Hex.splicing..mut.","Near.Splice.Junction....7.nt....1.Yes...0.No.","Turn"))
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
preds
dat2 <- dat[,c(95, 1+preds)]
dat2$Disease.associated <- as.factor(dat2$Disease.associated)
library(e1071)
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
library(randomForest)
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
importance(fitrf, type=1)
sum(diag(table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
fitglm <- glm(Disease.associated ~ ., data=dat2[train,], family = "binomial")
fitglm1 <- step(fitglm)
fitglm <- glm(Disease.associated ~ Hex.splicing..mut. + Near.Splice.Junction....7.nt....1.Yes...0.No. , data=dat2[train,], family = "binomial")
summary(fitglm1)
preds <- which(colnames(dat) %in% c("Hex.splicing..mut.","Near.Splice.Junction....7.nt....1.Yes...0.No.","Turn"))
preds
colnames(dat)[preds]
preds <- which(colnames(dat) %in% c("Near.Splice.Junction....7.nt....1.Yes...0.No.","Turn"))
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
dat2 <- dat[,c(95, 1+preds)]
dat2$Disease.associated <- as.factor(dat2$Disease.associated)
library(e1071)
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
colnames(dat)[preds]
preds <- which(colnames(dat) %in% c("Near.Splice.Junction....7.nt....1.Yes...0.No.","Turn"))
dat2 <- dat[,c(95, 1+preds)]
preds <- greendots
preds
preds <- greendots +1
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
dat2 <- dat[,c(95, preds)]
dat2$Disease.associated <- as.factor(dat2$Disease.associated)
library(e1071)
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
preds <- which(colnames(dat) %in% c("Hex.splicing..mut.","Near.Splice.Junction....7.nt....1.Yes...0.No.","Turn"))
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
preds <- greendots +1
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds
preds <- greendots
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
dat2 <- dat[,c(95, preds)]
dat[,95]
table(dat[,95])
colnames(dat)
dat[1:10,1]
dat <- read.csv("~/Desktop/Scaled_20230403.csv")
gene <- dat[,1]
dat <- dat[,-1]
disease <- which(dat$Disease.associated == 1)
nodisease <- which(dat$Disease.associated == 0)
sdis <- sort(sample(disease, 80))
sndis <- sort(sample(nodisease, 80))
M <- as.matrix(dat[c(sdis, sndis), ], ncol=ncol(dat), nrow=160)
bmfit <- betaMix(M, ind=TRUE)
plotFittedBetaMix(bmfit)
shortSummary(bmfit)
adjM <- Matrix(getAdjMat(bmfit, signed = TRUE))
image(adjM)
gc1 <- graphComponents(adjM, minCtr = 3, type = 1)
summarizeClusters(gc1)
plotCluster(adjM, 2, labels = TRUE, edgecols = c("blue","orange"))
Adj1 <- collapsedGraph(adjM, gc1) != 0
hist(dat$Hex.splicing..mut.[disease], breaks=30, freq=F)
hist(dat$Hex.splicing..mut.[nodisease], breaks=30, add=T, col=rgb(1,0,0,0.5), freq=F)
table(dat$Near.Splice.Junction....7.nt....1.Yes...0.No., dat$Disease.associated)
spineplot(table(dat$Near.Splice.Junction....7.nt....1.Yes...0.No., dat$Disease.associated))
table(dat$Turn, dat$Disease.associated)
spineplot(table(dat$Turn, dat$Disease.associated))
plot(graph.adjacency(Adj1, mode="undirected"), vertex.label=rownames(Adj1),
vertex.label.cex=0.7, vertex.size=0, vertex.frame.color="white",
vertex.label.color='blue', edge.color='grey80',  asp=1)
gc1[94,]
plotCluster(adjM, 7, labels = TRUE, edgecols = c("blue","orange"))
greendots <- which(adjM[94,] != 0)
cols <- c(rep('lightblue', 93), 'red')
cols[greendots] <- 'darkgreen'
plot(graph.adjacency(adjM!=0, mode="undirected"), vertex.label=rownames(adjM),
vertex.label.cex=0.7, vertex.size=0, vertex.frame.color="white",
vertex.label.color=cols, edge.color='grey80',  asp=1)
preds <- greendots
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
dat2 <- dat[,c(94, preds)]
dat2$Disease.associated <- as.factor(dat2$Disease.associated)
library(e1071)
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
library(randomForest)
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
importance(fitrf, type=1)
sum(diag(table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
train <- c(sdis, sort(sample(nodisease, 2545)))
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
library(randomForest)
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
library(randomForest)
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
rm(list=ls())
dev.off()
library(betaMix)
dat <- read.csv("~/Desktop/Scaled_20230403.csv")
gene <- dat[,1]
gene
gsub("_\\.*","", gene)
gsub("_\\\\.*","", gene)
gsub("_.*","", gene)
table(gsub("_.*","", gene))
plot(table(gsub("_.*","", gene)))
colnames(dat)
dat[,2]
dat <- dat[,-1]
disease <- which(dat$Disease.associated == 1)
nodisease <- which(dat$Disease.associated == 0)
colnames(dat)
disease <- which(dat$Disease.associated == 1)
nodisease <- which(dat$Disease.associated == 0)
sdis <- sort(sample(disease, 80))
sndis <- sort(sample(nodisease, 80))
M <- as.matrix(dat[c(sdis, sndis), ], ncol=ncol(dat), nrow=160)
bmfit <- betaMix(M, ind=TRUE)
plotFittedBetaMix(bmfit)
shortSummary(bmfit)
adjM <- Matrix(getAdjMat(bmfit, signed = TRUE))
image(adjM)
gc1 <- graphComponents(adjM, minCtr = 3, type = 1)
summarizeClusters(gc1)
gc1[94,]
Adj1 <- collapsedGraph(adjM, gc1) != 0
hist(dat$Hex.splicing..mut.[disease], breaks=30, freq=F)
hist(dat$Hex.splicing..mut.[nodisease], breaks=30, add=T, col=rgb(1,0,0,0.5), freq=F)
table(dat$Near.Splice.Junction....7.nt....1.Yes...0.No., dat$Disease.associated)
spineplot(table(dat$Near.Splice.Junction....7.nt....1.Yes...0.No., dat$Disease.associated))
table(dat$Turn, dat$Disease.associated)
spineplot(table(dat$Turn, dat$Disease.associated))
plot(graph.adjacency(Adj1, mode="undirected"), vertex.label=rownames(Adj1),
vertex.label.cex=0.7, vertex.size=0, vertex.frame.color="white",
vertex.label.color='blue', edge.color='grey80',  asp=1)
gc1[94,]
plotCluster(adjM, 7, labels = TRUE, edgecols = c("blue","orange"))
plotCluster(adjM, 3, labels = TRUE, edgecols = c("blue","orange"))
which(adjM[94,] !=0)
greendots <- which(adjM[94,] != 0)
cols <- c(rep('lightblue', 93), 'red')
cols[greendots] <- 'darkgreen'
plot(graph.adjacency(adjM!=0, mode="undirected"), vertex.label=rownames(adjM),
vertex.label.cex=0.7, vertex.size=0, vertex.frame.color="white",
vertex.label.color=cols, edge.color='grey80',  asp=1)
preds <- greendots
for (i in greendots) {
preds <- union(preds, which(adjM[i,] != 0))
}
preds <- setdiff(preds, 94)
dat2 <- dat[,c(94, preds)]
dat2$Disease.associated <- as.factor(dat2$Disease.associated)
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitsvm <- svm(Disease.associated ~ ., data=dat2[train,], type="C-classification")
table(predict(fitsvm, dat2[-train,]), dat2$Disease.associated[-train])
sum(diag(table(predict(fitsvm, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
fitrf <- randomForest(Disease.associated ~ ., data=dat2[train,])
table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])
importance(fitrf, type=1)
sum(diag(table(predict(fitrf, dat2[-train,-1]), dat2$Disease.associated[-train])))/nrow(dat2[-train,])
library(SEMMS)
fitS <- fitSEMMS(M, distribution = 'P')
getwd()
?readInputFile
save(M, "~/Desktop/samp.RData")
save(M, "/Users/haim/Desktop/samp.RData")
save(M, file="/Users/haim/Desktop/samp.RData")
dataYXZ <- readInputFile("/Users/haim/Desktop/samp.RData",ycol=94, Zcols = 1:93)
dataYXZ$Y
dataYXZ$P
dataYXZ$K
save(M, file="/Users/haim/Desktop/samp.RData")
dim(M)
fitS <- fitSEMMS(M, distribution = 'P')
fitS <- fitSEMMS(dataYXZ, distribution = 'P')
warning()
warnings()
fitS <- fitSEMMS(dataYXZ, distribution = 'P')
warnings()
fitS
fitS$gam.out$nn
fittedGLM <- runLinearModel(dataYXZ,fitS$gam.out$nn, "P")
plotMDS(dataYXZ, fitS, fittedGLM, ttl="")
fitS$gam.out$lockedOut
fitS$gam_nn
fitS$gam.out$nn
dataYXZ$originalZnames
dataYXZ$originalZnames[fitS$gam.out$nn]
dataYXZ$originalZnames[fitS$gam.out$lockedOut = =1]
dataYXZ$originalZnames[fitS$gam.out$lockedOut == 1]
cols <- which(colnames(dat2) %in% dataYXZ$originalZnames[fitS$gam.out$nn])
cols
dataYXZ$originalZnames[fitS$gam.out$nn]
colnames(dat2)
cols <- which(colnames(dat) %in% dataYXZ$originalZnames[fitS$gam.out$nn])
fitglm <- glm(Disease.associated ~ ., data=dat2[train, cols], family = "binomial")
#train <- c(sdis, sort(sample(nodisease, 2545)))
train <- c(sdis, sndis)
fitglm <- glm(Disease.associated ~ ., data=dat2[train, cols], family = "binomial")
fitglm <- glm(Disease.associated ~ ., data=dat[train, cols], family = "binomial")
fitglm <- glm(Disease.associated ~ ., data=dat[train, c(cols, 94)], family = "binomial")
summary(fitglm)
predict(fitglm, type="response")
plor(predict(fitglm, type="response"))
plot(predict(fitglm, type="response"))
table(predict(fitglm, type="response") > 0.5, dat$Disease.associated[-train])
table(predict(fitglm, newdata = dat[-train,], type="response") > 0.5, dat$Disease.associated[-train])
plot(predict(fitglm, newdata = dat[-train,],type="response"))
plot(predict(fitglm, newdata = dat[-train,],type="response"),
col=dat$Disease.associated[-train])
plot(predict(fitglm, newdata = dat[-train,],type="response"),
col=as.numeric(dat$Disease.associated[-train])+1)
plot(predict(fitglm, newdata = dat[-train,],type="response"),
col=as.numeric(dat$Disease.associated[-train])+1, pch=19, cex=0.5)
plot(predict(fitglm, newdata = dat[-train,],type="response"),
col=as.numeric(dat$Disease.associated[-train])+1, pch=19,
cex=0.5*(as.numeric(dat$Disease.associated[-train])+1))
table(predict(fitglm, newdata = dat[-train,], type="response") > 0.5,
dat$Disease.associated[-train])
dataYXZ <- readInputFile("/Users/haim/Desktop/samp.RData",ycol=94, Zcols = 1:93)
colnames(M)
dataYXZ <- readInputFile("/Users/haim/Desktop/samp.RData",ycol=94,
Xcols = 51, Zcols = setdiff(1:93, 51))
fitS <- fitSEMMS(dataYXZ, distribution = 'P')
plotMDS(dataYXZ, fitS, fittedGLM, ttl="")
plotMDS(dataYXZ, fitS, fittedGLM, ttl="")
cols <- which(colnames(dat) %in% dataYXZ$originalZnames[fitS$gam.out$nn])
cols <- which(colnames(dat) %in% dataYXZ$originalZnames[fitS$gam.out$nn])
cols
fitS <- fitSEMMS(dataYXZ, distribution = 'P')
fittedGLM <- runLinearModel(dataYXZ,fitS$gam.out$nn, "P")
plotMDS(dataYXZ, fitS, fittedGLM, ttl="")
summary(fittedGLM$mod)
dataYXZ$originalZnames[fitS$gam.out$nn]
setwd("~/Desktop")
setwd("~/Documents/GitHub/nostarch/Code")
set.seed(75473)
set.seed(75473)
n <- 40
samp <- rbinom(n, size=1, prob=18/37)
cat("Mean=",mean(samp), ", SD=",sd(samp),"\n")
set.seed(75473)
n <- 40
samp <- rbinom(n, size=1, prob=18/37)
cat("Mean=",mean(samp), ", SD=",sd(samp),"\n")
mean(samp)
source("~/Documents/GitHub/nostarch/Code/llnclt_roulette.R")
getwd()
cat("Prob. win=", mean(roulette),"\n")
n <- 10000
roulette <- rbinom(n, 1, 18/37)
cat("Prob. win=", mean(roulette),"\n")
cat("Paid: $", prettyNum(n, big.mark=","), ". Won: ", sum(roulette), "times.", "Total gain:", prettyNum(2*sum(roulette), big.mark = ","), "dollars. Net gain/loss:", prettyNum(2*sum(roulette)-n,big.mark = ","),"\n")
cat(paste0("Paid: $", prettyNum(n, big.mark=",")), ". Won: ", sum(roulette), "times.", "Total gain:", prettyNum(2*sum(roulette), big.mark = ","), "dollars. Net gain/loss:", prettyNum(2*sum(roulette)-n,big.mark = ","),"\n")
cat(paste0("$", prettyNum(n, big.mark=",")))
cat(sum(roulette))
cat(prettyNum(2*sum(roulette), big.mark = ","))
cat(prettyNum(2*sum(roulette)-10000, big.mark = ","))
cat(paste0("$",2*sum(roulette)))
n <- seq(50, 5000, by=10)
set.seed(59112)
allDiffs <- rep(0, length(n))
allRatios <- rep(0, length(n))
for (i in 1:length(n)) {
sA <- rnorm(n[i], 70, 10)
sB <- rnorm(n[i], 60, 20)
dAB <- sA - sB
rAB <- sA / sB
allDiffs[i] <- mean(dAB)
allRatios[i] <- mean(rAB)
}
par(mfrow=c(1, 2))
plot(n, allDiffs, pch=19, col=3, xlab="n", ylab="Diff.", cex=0.5)
abline(h=10, col=2, lwd=2)
plot(n, allRatios, pch=19, col="orange", xlab="n", ylab="Ratio", cex=0.5)
abline(h=70/60, col=2, lwd=2)
par(mfrow=c(1, 1))
